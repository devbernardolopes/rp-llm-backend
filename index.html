<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scenara</title>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5021422329745536"
      crossorigin="anonymous"
    ></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/flag-icons/css/flag-icons.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app-shell">
      <aside id="left-pane" class="expanded">
        <div class="pane-top">
          <div class="pane-top-header">
            <button id="home-btn" class="secondary-btn pane-home-btn">
              HOME
            </button>
            <button
              id="create-character-btn"
              class="primary-btn pane-create-char-btn"
              data-i18n="createCharacter"
            >
              + Character
            </button>
            <button
              id="import-character-btn"
              class="secondary-btn pane-create-char-btn pane-import-btn"
            >
              ^ Import Character
            </button>
            <input
              id="import-character-input"
              type="file"
              accept=".json,application/json"
              class="hidden"
            />
          </div>
          <div id="thread-list" class="thread-list"></div>
        </div>

        <div class="pane-bottom">
          <button
            class="option-btn"
            data-open-modal="settings-modal"
            data-i18n-title="settings"
            title="Settings"
            aria-label="Settings"
          >
            &#9881;
          </button>
          <button
            class="option-btn"
            data-open-modal="personas-modal"
            data-i18n-title="personas"
            title="Personas"
            aria-label="Personas"
          >
            &#128100;
          </button>
          <button
            class="option-btn"
            data-open-modal="lore-modal"
            data-i18n-title="loreBooks"
            title="Lore Books"
            aria-label="Lore Books"
          >
            &#128218;
          </button>
          <button
            class="option-btn"
            data-open-modal="shortcuts-modal"
            data-i18n-title="shortcuts"
            title="Shortcuts"
            aria-label="Shortcuts"
          >
            &#9000;
          </button>
          <button
            class="option-btn"
            data-open-modal="tags-modal"
            data-i18n-title="tags"
            title="Tags"
            aria-label="Tags"
          >
            &#127991;
          </button>
          <button
            class="option-btn"
            data-open-modal="database-modal"
            data-i18n-title="database"
            title="Database"
            aria-label="Database"
          >
            &#128451;
          </button>
          <button
            id="guide-btn"
            class="option-btn"
            data-i18n-title="guide"
            title="Guide"
            aria-label="Guide"
          >
            ?
          </button>
        </div>
      </aside>

      <main id="main-view" class="view active">
        <header class="main-header">
          <button
            id="pane-toggle"
            class="icon-btn"
            data-i18n-title="togglePane"
            title="Toggle pane"
            aria-label="Toggle pane"
          >
            =
          </button>
          <h1>SCENARA</h1>
        </header>
        <section id="character-filters" class="character-filters">
          <div class="character-filters-row">
            <input
              id="character-tag-filter-input"
              list="tag-presets"
              type="text"
              data-i18n-placeholder="filterByTag"
              placeholder="Filter by tag"
            />
            <button
              id="character-tag-filter-clear"
              class="secondary-btn"
              type="button"
              data-i18n="clear"
            >
              Clear
            </button>
            <select
              id="character-sort-select"
              data-i18n-title="characterOrdering"
              aria-label="Character ordering"
            >
              <option value="updated_desc" data-i18n="lastModifiedNewest">
                Last Modified: Newest
              </option>
              <option value="updated_asc" data-i18n="lastModifiedOldest">
                Last Modified: Oldest
              </option>
              <option value="created_desc" data-i18n="createdNewest">
                Created: Newest
              </option>
              <option value="created_asc" data-i18n="createdOldest">
                Created: Oldest
              </option>
              <option value="threads_desc" data-i18n="threadsMost">
                Threads: Most
              </option>
              <option value="threads_asc" data-i18n="threadsLeast">
                Threads: Least
              </option>
              <option value="name_asc" data-i18n="nameAsc">Name: A-Z</option>
              <option value="name_desc" data-i18n="nameDesc">Name: Z-A</option>
            </select>
          </div>
          <div id="character-tag-filter-chips" class="filter-chips"></div>
          <div
            id="character-filter-active-cue"
            class="filter-active-cue hidden"
            data-i18n="tagFiltersActive"
          >
            Tag filters active.
          </div>
        </section>
        <section id="character-grid" class="character-grid"></section>
      </main>

      <section id="chat-view" class="view">
        <header class="chat-header">
          <button
            id="pane-toggle-chat"
            class="icon-btn"
            data-i18n-title="togglePane"
            title="Toggle pane"
            aria-label="Toggle pane"
          >
            =
          </button>
          <div id="chat-title">Thread</div>
          <button
            id="auto-tts-toggle-btn"
            class="icon-btn"
            data-i18n-title="autoTtsTitleOff"
            title="Auto TTS: Off"
            aria-label="Toggle auto TTS"
          ></button>
          <div id="chat-model-pill" class="model-pill">Model: -</div>
          <div id="chat-budget-pill" class="model-pill">Max out: -</div>
        </header>

        <div id="chat-log" class="chat-log"></div>
        <button
          id="scroll-bottom-btn"
          class="icon-btn hidden"
          data-i18n-title="scrollToBottom"
          title="Scroll to bottom"
          aria-label="Scroll to bottom"
        >
          v
        </button>

        <div
          id="prompt-history-popover"
          class="popover hidden"
          role="dialog"
          data-i18n-title="promptHistory"
          aria-label="Prompt history"
        >
          <div class="popover-title" data-i18n="previousPrompts">
            Previous prompts
          </div>
          <div id="prompt-history-list" class="prompt-history-list"></div>
        </div>

        <div id="shortcuts-bar" class="shortcuts-bar"></div>

        <div class="input-row">
          <div class="prompt-col">
            <textarea
              id="user-input"
              rows="3"
              data-i18n-placeholder="promptPlaceholder"
              placeholder="What do you say or do? Enter to send, Shift+Enter for newline"
            ></textarea>
          </div>
          <div class="send-col">
            <label class="persona-picker in-send-col">
              <div class="persona-inline">
                <img
                  id="persona-selected-avatar"
                  class="persona-selected-avatar"
                  data-i18n-title="selectedPersonaAvatar"
                  alt="Persona avatar"
                />
                <select
                  id="persona-select"
                  data-i18n-title="selectPersona"
                  aria-label="Select persona"
                ></select>
              </div>
            </label>
            <button id="send-btn" class="primary-btn" data-i18n="send">
              Send
            </button>
            <div class="send-toggle-row">
              <button
                id="auto-reply-enabled"
                class="option-btn send-toggle-btn"
                type="button"
                data-i18n-title="autoReply"
                title="Auto-reply"
                aria-label="Auto-reply"
              >
                🤖
              </button>
              <button
                id="enter-to-send-enabled"
                class="option-btn send-toggle-btn"
                type="button"
                data-i18n-title="enterToSend"
                title="ENTER to send"
                aria-label="ENTER to send"
              >
                ⏎
              </button>
              <button
                id="shortcuts-toggle-btn"
                class="option-btn send-toggle-btn"
                type="button"
                data-i18n-title="showShortcuts"
                title="Show shortcuts"
                aria-label="Show shortcuts"
              >
                ⌨
              </button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div id="modal-layer"></div>

    <div
      id="toast-container"
      class="toast-container"
      aria-live="polite"
      aria-atomic="true"
    ></div>

    <div
      id="confirm-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="confirm-title"
    >
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="confirm-title">Confirm</h3>
          <button
            class="icon-btn modal-close"
            id="confirm-cancel-btn"
            aria-label="Close confirmation"
          >
            &times;
          </button>
        </div>
        <div class="modal-body">
          <p id="confirm-message"></p>
        </div>
        <div class="modal-footer">
          <button id="confirm-no-btn" class="secondary-btn">Cancel</button>
          <button id="confirm-yes-btn" class="primary-btn">Confirm</button>
        </div>
      </div>
    </div>

    <div
      id="text-input-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="text-input-title"
    >
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="text-input-title">Rename</h3>
          <button
            class="icon-btn modal-close"
            id="text-input-cancel-x"
            aria-label="Close input modal"
          >
            &times;
          </button>
        </div>
<div class="modal-body">
          <div class="form-field">
            <span id="text-input-label">Value</span>
            <input id="text-input-value" type="text" maxlength="128" />
          </div>
        </div>
        <div class="modal-footer">
          <button id="text-input-cancel" class="secondary-btn">Cancel</button>
          <button id="text-input-save" class="primary-btn">Save</button>
        </div>
      </div>
    </div>

    <div
      id="settings-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="settings-title"
    >
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="settings-title" data-i18n="settingsTitle">Settings</h3>
          <button class="icon-btn modal-close" data-close-modal>&times;</button>
        </div>
        <div class="settings-tabs" id="settings-tabs">
          <button
            class="settings-tab-btn active"
            type="button"
            data-settings-tab-btn="appearance"
            data-i18n="tabAppearance"
          >
            Appearance
          </button>
          <button
            class="settings-tab-btn"
            type="button"
            data-settings-tab-btn="api"
            data-i18n="tabApi"
          >
            API
          </button>
          <button
            class="settings-tab-btn"
            type="button"
            data-settings-tab-btn="tts"
            data-i18n="tabTts"
          >
            TTS
          </button>
          <button
            class="settings-tab-btn"
            type="button"
            data-settings-tab-btn="threads"
            data-i18n="tabThreads"
          >
            Threads
          </button>
          <button
            class="settings-tab-btn"
            type="button"
            data-settings-tab-btn="shortcuts"
            data-i18n="tabShortcuts"
          >
            Shortcuts
          </button>
          <button
            class="settings-tab-btn"
            type="button"
            data-settings-tab-btn="prompting"
            data-i18n="tabPrompting"
          >
            Prompting
          </button>
        </div>
        <div class="modal-body" id="settings-modal-body">
<div class="form-field" data-settings-group="appearance">
            <div class="label-inline">
              <span data-i18n="toastDelayLabel">Toast Delay</span>
              <span id="toast-delay-value" class="muted"></span>
            </div>
            <input
              id="toast-delay-slider"
              type="range"
              min="1000"
              max="10000"
              step="200"
            />
          </div>
<div class="form-field" data-settings-group="appearance">
            <span data-i18n="marqueeBehaviorLabel">Marquee Behavior</span>
            <select id="marquee-behavior-select">
              <option value="disabled" data-i18n="marqueeBehaviorDisabled">
                Disabled
              </option>
              <option value="hover" data-i18n="marqueeBehaviorOnHover">
                On Hover
              </option>
              <option value="always" data-i18n="marqueeBehaviorAlways">
                Always
              </option>
            </select>
          </div>
<div class="form-field">
            <span data-i18n="languageLabel">Interface Language</span>
            <select id="ui-language-select">
              <option value="auto">Auto (browser)</option>
              <option value="en">English</option>
              <option value="fr">Francais</option>
              <option value="it">Italiano</option>
              <option value="de">Deutsch</option>
              <option value="es">Espanol</option>
              <option value="pt-BR">Portugues (Brasil)</option>
            </select>
          </div>
<div class="form-field">
            <span data-i18n="openRouterApiKey">OpenRouter API Key</span>
            <input
              id="openrouter-api-key"
              type="password"
              placeholder="sk-or-v1-..."
              autocomplete="off"
              spellcheck="false"
            />
          </div>
<div class="form-field">
            <span data-i18n="modelLabel">Model</span>
            <select id="model-select"></select>
          </div>
          <div class="settings-inline-row model-filter-row">
<div class="form-field">
              <span data-i18n="pricingLabel">Pricing</span>
              <select id="model-pricing-filter">
                <option value="all" data-i18n="all">All</option>
                <option value="free" data-i18n="free">Free</option>
                <option value="paid" data-i18n="paid">Paid</option>
              </select>
            </div>
<div class="form-field">
              <span data-i18n="modalityLabel">Modality</span>
              <select id="model-modality-filter">
                <option value="text-only" data-i18n="textToText">
                  Text -&gt; Text
                </option>
                <option value="all" data-i18n="all">All</option>
              </select>
            </div>
<div class="form-field">
              <span data-i18n="orderLabel">Order</span>
              <select id="model-sort-order">
                <option value="name_asc" data-i18n="nameAsc">Name A-Z</option>
                <option value="name_desc" data-i18n="nameDesc">Name Z-A</option>
                <option value="created_desc" data-i18n="createdNewest">
                  Created Newest
                </option>
                <option value="created_asc" data-i18n="createdOldest">
                  Created Oldest
                </option>
              </select>
            </div>
            <button
              id="model-refresh-btn"
              class="secondary-btn"
              type="button"
              data-i18n="reload"
            >
              Reload
            </button>
          </div>
          <div id="model-selected-meta" class="muted"></div>
          <div id="model-roleplay-warning" class="model-warning hidden">
            <span data-i18n="modelNotRecommendedRoleplay"
              >This model is NOT recommended for roleplaying.</span
            >
          </div>
<div class="form-field">
            <div class="label-inline">
              <span data-i18n="maxTokensLabel">Max Tokens</span>
              <span id="max-tokens-value" class="muted"></span>
            </div>
            <input
              id="max-tokens-slider"
              type="range"
              min="512"
              max="8192"
              step="64"
            />
          </div>
<div class="form-field">
            <div class="label-inline">
              <span data-i18n="temperatureLabel">Temperature</span>
              <span id="temperature-value" class="muted"></span>
            </div>
            <input
              id="temperature-slider"
              type="range"
              min="0"
              max="2"
              step="0.05"
            />
          </div>
          <div class="form-field">
            <div class="label-inline">
              <span data-i18n="completionCooldownLabel">Completion Cooldown</span>
              <span id="completion-cooldown-value" class="muted"></span>
            </div>
            <input
              id="completion-cooldown-slider"
              type="range"
              min="0"
              max="15"
              step="1"
            />
          </div>
          <div class="form-field">
            <span data-i18n="ttsTestTextLabel">TTS Test Text</span>
            <textarea
              id="tts-test-text"
              rows="2"
              placeholder="This is a test voice playback."
            ></textarea>
          </div>
          <div class="settings-inline-row">
            <button
              id="tts-test-play-btn"
              class="secondary-btn"
              type="button"
              data-i18n="playTtsTest"
            >
              Play TTS Test
            </button>
            <span id="tts-test-status" class="muted">TTS: idle</span>
          </div>
<span class="checkbox-line">
            <input type="checkbox" id="markdown-enabled" />
            <span data-i18n="renderMarkdown">Render Markdown in messages</span>
          </span>
<span class="checkbox-line">
            <input type="checkbox" id="allow-message-html" />
            <span data-i18n="allowRawHtml">Allow raw HTML in messages</span>
          </span>
<span class="checkbox-line">
            <input type="checkbox" id="stream-enabled" checked />
            <span data-i18n="streamMessages">Stream Messages</span>
          </span>
<span class="checkbox-line">
            <input type="checkbox" id="autopair-enabled" checked />
            <span data-i18n="autoPairSymbols">Auto-pair editor symbols</span>
          </span>
<span class="checkbox-line">
            <input type="checkbox" id="thread-autotitle-enabled" checked />
            <span data-i18n="threadAutoTitleEnabled"
              >Enable Auto-titling for Threads</span
            >
          </span>
<div class="form-field">
            <span data-i18n="threadAutoTitleMinMessages">Min. Messages</span>
            <input
              id="thread-autotitle-min-messages"
              type="number"
              min="5"
              max="15"
              step="1"
              value="7"
            />
          </div>
<div class="form-field">
            <span data-i18n="chatMessageAlignment">Message Alignment</span>
            <select id="chat-message-alignment">
              <option value="left" data-i18n="messageAlignmentLeft">
                Left (Default)
              </option>
              <option value="center" data-i18n="messageAlignmentCenter">
                Center
              </option>
            </select>
          </div>
<div class="form-field">
            <span data-i18n="markdownCustomCss">Markdown Custom CSS</span>
            <textarea
              id="markdown-custom-css"
              rows="6"
              placeholder=".md-em { color: #E6D97A; }"
            ></textarea>
          </div>
<div class="form-field">
            <span data-i18n="postprocessRules"
              >Post-processing Rules (JSON)</span
            >
            <textarea
              id="postprocess-rules-json"
              rows="8"
              placeholder='[{"pattern":"^Â«([\\s\\S]*)Â»$","flags":"gm","replacement":"<span style=\"color:#E6D97A\">Â«$1Â»</span>"}]'
            ></textarea>
          </div>
<div class="form-field">
            <span data-i18n="cancelGenerationShortcut"
              >Cancel Generation Shortcut</span
            >
            <input id="cancel-shortcut" type="text" placeholder="Ctrl+." />
          </div>
<div class="form-field">
            <span data-i18n="goHomeShortcut">Go Home Shortcut</span>
            <input id="home-shortcut" type="text" placeholder="Alt+H" />
          </div>
<div class="form-field">
            <span data-i18n="newCharacterShortcut">New Character Shortcut</span>
            <input
              id="new-character-shortcut"
              type="text"
              placeholder="Alt+N"
            />
          </div>
<div class="form-field">
            <span data-i18n="defaultCharacterPrompt"
              >Default Character Prompt</span
            >
            <textarea
              id="global-prompt-template"
              rows="7"
              placeholder="Used when a character prompt is empty."
            ></textarea>
          </div>
<div class="form-field">
            <span data-i18n="memorySummarizerPrompt"
              >Memory Summarizer System Prompt</span
            >
            <textarea
              id="summary-system-prompt"
              rows="3"
              placeholder="System prompt for memory summarization."
            ></textarea>
          </div>
<div class="form-field">
            <span data-i18n="personaInjectionTemplate"
              >Persona Injection Template</span
            >
            <textarea
              id="persona-injection-template"
              rows="5"
              placeholder="Template for active persona injection."
            ></textarea>
          </div>
<div class="form-field">
            <span data-i18n="personaInjectionTiming"
              >Persona Injection Timing</span
            >
            <select id="persona-injection-when">
              <option value="always" data-i18n="always">Always</option>
              <option value="on_change" data-i18n="onPersonaChange">
                On Persona Change (first message always injects)
              </option>
            </select>
          </div>
<div class="form-field">
            <span data-i18n="writingInstructionsInjectionTiming"
              >Writing Instructions Injection Timing</span
            >
            <select id="writing-instructions-injection-when">
              <option value="always" data-i18n="always">Always</option>
              <option value="every_other" data-i18n="everyOther">
                Every Other
              </option>
              <option value="every_second" data-i18n="everySecond">
                Every Second
              </option>
              <option value="every_third" data-i18n="everyThird">
                Every Third
              </option>
              <option value="every_fourth" data-i18n="everyFourth">
                Every Fourth
              </option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div
      id="personas-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="personas-title"
    >
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="personas-title" data-i18n="personas">Personas</h3>
          <button class="icon-btn modal-close" data-close-modal>&times;</button>
        </div>
        <div class="modal-body">
<div class="form-field">
            <div class="label-inline">
              <span data-i18n="nameLabel">Name</span>
              <span id="persona-name-count" class="muted">0/64</span>
            </div>
            <input id="persona-name" type="text" maxlength="64" />
          </div>
<div class="form-field">
            <span data-i18n="avatarUrl">Avatar URL</span>
            <input id="persona-avatar" type="text" placeholder="optional" />
          </div>
<div class="form-field">
            <span data-i18n="avatarFile">Avatar File</span>
            <input id="persona-avatar-file" type="file" accept="image/*" />
          </div>
<div class="form-field">
            <div class="label-inline">
              <span data-i18n="personaDescription"
                >Description (max 100 chars)</span
              >
              <span id="persona-description-count" class="muted">0/100</span>
            </div>
            <textarea
              id="persona-description"
              rows="3"
              maxlength="100"
            ></textarea>
          </div>
<div class="form-field">
            <span data-i18n="personaInternalDescription"
              >Internal Description (optional)</span
            >
            <textarea id="persona-internal-description" rows="4"></textarea>
          </div>
<span class="checkbox-line">
            <input id="persona-is-default" type="checkbox" />
            <span data-i18n="setDefaultPersona">Set as default persona</span>
          </span>
          <button
            id="save-persona-btn"
            class="primary-btn"
            data-i18n="savePersona"
          >
            Save Persona
          </button>
          <div id="persona-list" class="check-list"></div>
        </div>
      </div>
    </div>

    <div
      id="lore-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="lore-title"
    >
      <div class="modal-card wide">
        <div class="modal-header">
          <h3 id="lore-title" data-i18n="loreBookManagement">
            Lore Book Management
          </h3>
          <button class="icon-btn modal-close" data-close-modal>&times;</button>
        </div>
        <div class="modal-body">
          <div id="lore-list-view">
            <div class="lore-toolbar">
              <button
                id="create-lorebook-btn"
                class="primary-btn"
                type="button"
                data-i18n="createLoreBook"
              >
                + Create Lore Book
              </button>
              <button
                id="import-lorebook-btn"
                class="secondary-btn"
                type="button"
                data-i18n="importLoreBook"
              >
                ^ Import Lore Book
              </button>
            </div>
            <div id="lorebook-list" class="lorebook-list"></div>
          </div>

          <div id="lore-editor-view" class="hidden">
            <div class="lore-toolbar">
              <button
                id="lore-editor-back-btn"
                class="secondary-btn"
                type="button"
                data-i18n="backToList"
              >
                < Back to List
              </button>
            </div>
            <div class="two-col lore-editor-grid">
<div class="form-field">
                <span data-i18n="nameLabel">Name</span>
                <input
                  id="lore-name"
                  type="text"
                  minlength="2"
                  maxlength="128"
                />
              </div>
<div class="form-field">
                <span data-i18n="avatarUrlOptional">Avatar URL (optional)</span>
                <input id="lore-avatar" type="text" placeholder="optional" />
              </div>
<div class="form-field full">
                <span data-i18n="descriptionOptional"
                  >Description (optional)</span
                >
                <textarea
                  id="lore-description"
                  rows="3"
                  maxlength="512"
                ></textarea>
              </div>
<div class="form-field">
                <span data-i18n="scanDepth">Scan Depth</span>
                <input
                  id="lore-scan-depth"
                  type="number"
                  min="5"
                  max="100"
                  step="1"
                />
              </div>
<div class="form-field">
                <span data-i18n="tokenBudget">Token Budget</span>
                <input
                  id="lore-token-budget"
                  type="number"
                  min="100"
                  max="1000"
                  step="10"
                />
              </div>
<span class="checkbox-line">
                <input id="lore-recursive-scanning" type="checkbox" />
                <span data-i18n="recursiveScanning">Recursive Scanning</span>
              </span>
            </div>
            <div class="lore-entry-head">
              <h4 id="lore-entries-title">Entries</h4>
              <button
                id="add-lore-entry-btn"
                class="secondary-btn"
                type="button"
                data-i18n="addEntry"
              >
                + Add Entry
              </button>
            </div>
            <div id="lore-entries-list" class="lore-entries-list"></div>
            <div class="modal-footer">
              <button
                id="cancel-lore-editor-btn"
                class="secondary-btn"
                type="button"
                data-i18n="cancel"
              >
                Cancel
              </button>
              <button
                id="save-lorebook-btn"
                class="primary-btn"
                type="button"
                data-i18n="saveLoreBook"
              >
                Save Lore Book
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      id="shortcuts-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="shortcuts-title"
    >
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="shortcuts-title" data-i18n="shortcuts">Shortcuts</h3>
          <button class="icon-btn modal-close" data-close-modal>&times;</button>
        </div>
<div class="modal-body">
          <div class="form-field">
            <span data-i18n="shortcutEntries">Shortcut Entries</span>
            <textarea id="shortcuts-raw" rows="14"></textarea>
          </div>
          <button
            id="save-shortcuts-btn"
            class="primary-btn"
            data-i18n="saveShortcuts"
          >
            Save Shortcuts
          </button>
        </div>
      </div>
    </div>

    <div
      id="database-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="database-title"
    >
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="database-title" data-i18n="databaseManagement">
            Database Management
          </h3>
          <button class="icon-btn modal-close" data-close-modal>&times;</button>
        </div>
        <div class="modal-body">
          <button id="export-db-btn" class="primary-btn" type="button">
            Export Database
          </button>
          <button id="import-db-btn" class="secondary-btn" type="button">
            Import Database
          </button>
          <button
            id="reset-db-btn"
            class="secondary-btn danger-btn"
            type="button"
            data-i18n="resetAppData"
          >
            Reset App Data
          </button>
          <input
            id="import-db-input"
            type="file"
            accept=".json,application/json"
            class="hidden"
          />
          <p id="database-hint" class="muted">
            Import will overwrite the current local data (characters, threads,
            settings, UI state, and more).
          </p>
        </div>
      </div>
    </div>

    <div
      id="tags-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="tags-title"
    >
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="tags-title" data-i18n="tagManager">Tag Manager</h3>
          <button class="icon-btn modal-close" data-close-modal>&times;</button>
        </div>
        <div class="modal-body">
          <div class="tag-manager-input-row">
            <input
              id="tag-manager-input"
              type="text"
              data-i18n-placeholder="tagInputPlaceholder"
              placeholder="New tag"
            />
            <button id="add-tag-btn" class="primary-btn" type="button" disabled>
              +
            </button>
          </div>
          <div id="tag-manager-list" class="tag-manager-list"></div>
        </div>
      </div>
    </div>

    <div
      id="character-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="character-title"
    >
      <div class="modal-card wide">
        <div class="modal-header">
          <h3 id="character-title" data-i18n="createCharacterTitle">
            Create Character
          </h3>
          <button class="icon-btn modal-close" data-close-modal>&times;</button>
        </div>
        <div id="char-def-tabs" class="settings-tabs">
          <button
            id="char-config-tab-btn"
            class="settings-tab-btn"
            type="button"
            data-i18n="botConfiguration"
          >
            Bot Configuration
          </button>
          <div class="char-def-tabs-row">
            <div id="char-def-tabs-left" class="char-def-tabs-left"></div>
            <button id="char-add-lang-btn" class="settings-tab-btn" type="button">
              +
            </button>
          </div>
        </div>
        <div class="modal-body two-col">
          <div class="full lang-field">
            <span data-i18n="avatars" class="block mb-2">Avatars</span>
            <div id="char-avatars-container" class="char-avatars-container">
              <button type="button" id="char-avatar-dropzone" class="char-avatar-dropzone" tabindex="0" aria-label="Upload avatar">
                <span class="dropzone-plus">+</span>
                <span class="dropzone-hint">Drag & drop or click</span>
              </button>
              <input type="file" id="char-avatar-file-input" accept="image/*,video/mp4" multiple class="visually-hidden" />
            </div>
          </div>
          <div class="full lang-field">
            <div class="label-inline">
              <span data-i18n="nameLabel">Name</span>
              <span id="char-name-count" class="muted">0/128</span>
            </div>
            <input id="char-name" type="text" maxlength="128" />
          </div>
          <div class="full lang-field">
            <span data-i18n="characterPrompt">Character Prompt</span>
            <textarea id="char-system-prompt" rows="8"></textarea>
          </div>
          <div class="full global-field">
            <span class="checkbox-line">
              <input
                id="char-prefer-persona-language"
                type="checkbox"
                checked
              />
              <span data-i18n="preferLanguageMatchingUserPersona"
                >Prefer Language Matching User Persona</span
              >
            </span>
          </div>
          <div class="full global-field">
            <span data-i18n="defaultPersonaOverride"
              >Default User Persona Override (Character-only)</span
            >
            <select id="char-default-persona-override"></select>
          </div>
          <div class="full lang-field">
            <span data-i18n="oneTimeExtraPrompt"
              >One-time only Extra System/Character Prompt</span
            >
            <textarea
              id="char-one-time-extra-prompt"
              rows="4"
              placeholder="Appended only for the first assistant generation."
            ></textarea>
          </div>
          <div class="full lang-field">
            <span data-i18n="writingInstructions">Writing Instructions</span>
            <textarea
              id="char-writing-instructions"
              rows="4"
              placeholder="Reserved for future implementation."
            ></textarea>
          </div>
          <div class="full lang-field">
            <span data-i18n="initialMessages">Initial Messages</span>
            <textarea
              id="char-initial-messages"
              rows="8"
              placeholder="[AI]: text...

[USER]: text...

[SYSTEM]: text..."
            ></textarea>
          </div>
          <div class="full global-field">
            <span data-i18n="tagsCommaSeparated">Tags (comma-separated)</span>
            <input
              id="char-tags-input"
              list="tag-presets"
              type="text"
              placeholder="Roleplay, Female, Hero"
            />
            <div id="char-tags-presets" class="tag-presets-list"></div>
          </div>
          <div class="full lang-field">
            <span data-i18n="personaInjectionPlacement"
              >Persona Injection Placement</span
            >
            <select id="char-persona-injection-placement">
              <option
                value="end_system_prompt"
                data-i18n="atEndCharacterPrompt"
              >
                At End of Character Prompt
              </option>
            </select>
          </div>
          <div class="global-field">
            <span class="checkbox-line">
              <input id="char-use-memory" type="checkbox" />
              <span data-i18n="enableMemory">Enable Memory</span>
            </span>
          </div>
          <div class="global-field">
            <span class="checkbox-line">
              <input id="char-use-postprocess" type="checkbox" checked />
              <span data-i18n="enablePostprocess"
                >Enable Post-processing Rules</span
              >
            </span>
          </div>
          <div class="global-field">
            <span class="checkbox-line">
              <input id="char-auto-trigger-first-ai" type="checkbox" checked />
              <span data-i18n="autoTriggerAiFirst"
                >Auto-trigger AI first message</span
              >
            </span>
          </div>
          <div class="global-field">
            <span data-i18n="avatarScaleInChat">Avatar Scale (In Chat)</span>
            <select id="char-avatar-scale">
              <option value="1">1x</option>
              <option value="2">2x</option>
              <option value="3">3x</option>
              <option value="4">4x</option>
            </select>
          </div>
          <div class="lang-field">
            <span class="checkbox-line">
              <input id="char-tts-enabled" type="checkbox" checked />
              <span data-i18n="enableTts">Enable TTS</span>
            </span>
          </div>
          <div class="lang-field">
            <span data-i18n="ttsLanguage">TTS Language</span>
            <select id="char-tts-language"></select>
          </div>
          <div class="lang-field">
            <span data-i18n="ttsVoice">TTS Voice</span>
            <select id="char-tts-voice"></select>
          </div>
          <div class="lang-field">
            <div class="label-inline">
              <span data-i18n="ttsRate">TTS Rate</span>
              <span id="char-tts-rate-value" class="muted"></span>
            </div>
            <input
              id="char-tts-rate"
              type="range"
              min="0.5"
              max="2"
              step="0.1"
            />
          </div>
          <div class="lang-field">
            <div class="label-inline">
              <span data-i18n="ttsPitch">TTS Pitch</span>
              <span id="char-tts-pitch-value" class="muted"></span>
            </div>
            <input
              id="char-tts-pitch"
              type="range"
              min="0"
              max="2"
              step="0.1"
            />
          </div>
          <div class="full lang-field">
            <button id="char-tts-test-btn" class="secondary-btn" type="button">
              <span data-i18n="testCharacterVoice">Test Character Voice</span>
            </button>
          </div>
          <div class="full lang-field">
            <span class="checkbox-line">
              <input id="char-prefer-lore-language" type="checkbox" checked />
              <span data-i18n="preferLoreBooksInMatchingLanguage"
                >Prefer Lore Books in Matching Language</span
              >
            </span>
          </div>
          <div class="full lang-field">
            <span data-i18n="loreBooksForCharacter"
              >Lore Books for this character</span
            >
            <div id="char-lorebooks-list" class="check-list"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="secondary-btn" data-close-modal data-i18n="cancel">
            Cancel
          </button>
          <button id="save-character-btn" class="primary-btn" data-i18n="save">
            Save
          </button>
        </div>
      </div>
    </div>

    <div
      id="char-language-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="char-language-title"
    >
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="char-language-title" data-i18n="addLanguage">Add Language</h3>
          <button
            class="icon-btn modal-close"
            id="char-language-cancel-x"
            aria-label="Close"
          >
            &times;
          </button>
        </div>
<div class="modal-body">
          <div class="form-field">
            <select id="char-language-select"></select>
          </div>
        </div>
        <div class="modal-footer">
          <button
            id="char-language-cancel"
            class="secondary-btn"
            type="button"
            data-i18n="cancel"
          >
            Cancel
          </button>
          <button
            id="char-language-add"
            class="primary-btn"
            type="button"
            data-i18n="add"
          >
            Add
          </button>
        </div>
      </div>
    </div>

    <datalist id="tag-presets"></datalist>

    <div
      id="image-preview-modal"
      class="modal hidden image-preview-modal"
      role="dialog"
      aria-modal="true"
      aria-label="Media preview"
    >
      <div class="modal-card image-preview-card">
        <button
          id="image-preview-download-btn"
          class="icon-btn image-preview-download-btn"
          type="button"
          title="Download"
          aria-label="Download"
        >
          v
        </button>
        <img id="image-preview-img" alt="Preview" />
        <video id="image-preview-video" controls class="hidden"></video>
      </div>
    </div>

    <div
      id="message-metadata-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="message-metadata-title"
    >
      <div class="modal-card wide">
        <div class="modal-header">
          <h3 id="message-metadata-title">Message Metadata</h3>
          <button
            class="icon-btn modal-close"
            data-close-modal
            aria-label="Close metadata"
          >
            &times;
          </button>
        </div>
        <div class="modal-body">
          <pre id="message-metadata-json" class="metadata-json"></pre>
        </div>
      </div>
    </div>

    <div
      id="message-context-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="message-context-title"
    >
      <div class="modal-card wide">
        <div class="modal-header">
          <h3 id="message-context-title">Message Context</h3>
          <button
            class="icon-btn modal-close"
            data-close-modal
            aria-label="Close context"
          >
            &times;
          </button>
        </div>
        <div class="modal-body">
          <pre id="message-context-json" class="metadata-json"></pre>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/dexie@3/dist/dexie.js"></script>
    <script src="config.js"></script>
    <script src="db.js"></script>
    <script src="app.js"></script>
  </body>
</html>
